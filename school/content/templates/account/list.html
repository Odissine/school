{% extends 'layouts/default/base.html' %}
{% load i18n %}
{% load auth_extras %}
{% block title %}School @ ENDTG - Accueil{% endblock %}
{% load crispy_forms_tags %}
{% block content %}
<div class="modal fade" tabindex="-1" id="modalChangePwd">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form class="" action="{% url 'account:change-password' %}" method="POST">
                <div class="modal-header bg-primary" style="color:white !important;">
                    <h5 class="modal-title">Changement de mot de passe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                </div>
                <div class="text-dark m-2" id="labelTitle"></div>
                    {% csrf_token %}
                    <input type="hidden" value="" id="idUser" name="idUser">
                    <div class="text-dark m-3">
                    <input class="form-control px-3" type="text" name="password">
                    </div>
                <div class="modal-footer">
                    <button class="btn btn-success" type="submit">Enregistrer</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                </div>
                </form>
            </div>
        </div>
    </div>
<div class="mot-box">
<h2>LISTE DES UTILISATEURS</h2>
    <h5>{{ group_name }}</h5>
<form method="POST" action="">
    {% csrf_token %}
    <select name="group" id="group" class="form-select">
        <option value="">TOUS</option>
        <option value="CP">CP</option>
        <option value="CE1">CE1</option>
        <option value="CE2">CE2</option>
        <option value="CM1">CM1</option>
        <option value="CM2">CM2</option>
        <option value="ADMIN">ADMIN</option>
        <option value="ENSEIGNANTS">ENSEIGNANTS</option>
        <option value="ELEVE">ELEVE</option>
    </select>
    <div class="d-grid gap-2">
        <button type="submit" class="btn btn-success">Filtrer</button>
    </div>
</form>
    {% if list|length > 0 %}
    <table class="table table-striped table-dark">
    <thead>
    <tr>
        <th scope="col">PRENOM</th>
        <th scope="col">NOM</th>
        <th scope="col">CLASSE</th>
        <th scope="col">LETTRE MAX (MOY)</th>
        <th scope="col">MOTS MAX (MOY)</th>
        <th></th>
    <tr>
    </thead>
    <tbody>
    {% for user in list %}
    <tr>
        <td>{{ user.prenom }}</td>
        <td>{{ user.nom }}</td>
        <td>{{ user.classe }}</td>
        <td>{{ user.max_lettre }} ({{ user.moyenne_lettre }})</td>
        <td>{{ user.max_mot }} ({{ user.moyenne_mot }})</td>
        <td><label class="btn btn-default">
            <button class="btn btn-primary" name="userPwd" vId="{{ user.id }}" type="radio" vNom="{{ user.nom }}" vPrenom="{{ user.prenom }}"><i class="bi bi-check"></i></button>
            </label>
        </td>
    <tr>
    {% endfor %}
    </tbody>
    </table>
    {% else %}
    <div>Aucune r√©sultat</div>
    {% endif %}
</div>
<script>
    $(document).ready(function(){
        $('[name="userPwd"]').click(function () {
            $('#modalChangePwd').modal('show');
            var valueis = $(this).val();
            var prenom = $(this).attr("vPrenom");
            var nom = $(this).attr("vNom");
            var id = $(this).attr("vId");
            console.log(valueis);
            $("#labelTitle").html("Modification du mot de passe de " + prenom + " " + nom);
            $("#idUser").val(id);
        });
    });
</script>
{% endblock %}